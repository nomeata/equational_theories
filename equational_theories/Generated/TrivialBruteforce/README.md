This directory contains a simple bruteforce script with several theorems for several trivial 'proof scripts'. The results have been minimized by only including implications necessary for the transitive reduction of all bruteforce-generated theorems.

The transitive closure (e.g. total number of derived implications) of the theorems proven by {Apply.lean, RewriteGoal.lean, RewriteHypothesis.lean, RewriteHypothesisAndGoal.lean} is 4,299,405.

The following are directions to reproduce the theorems in this directory:
1) Generate refutations

I generate refuted implications to cut down on the amount of proving work. This takes data from Nicholas Carlini, and generates a CSV of not-implication pairs that our bruteforce does not have to check

```sh
python generate_refutations.py > REFUTATION_PAIRS.csv
```

2) Generate lean files to bruteforce

Modify the code in bruteforce.rb to generate theorems in whatever form you'd like to test. The theorems in this directory were generated by testing the following proofs:

```
   repeat intro
   apply h
```
```
   repeat intro
   repeat rw [h]
```
```
   repeat intro
   try { rw [<-h] }
   try { rw [<-h, <-h] }
   try { rw [<-h, <-h, <-h] }
   try { rw [<-h, <-h, <-h, <-h] }
   try { rw [<-h, <-h, <-h, <-h, <-h] }
   repeat rw [h]
```
```
  intro a
  repeat intro
  try { rw [h a, <-h] }
  try { rw [h a a, <-h] }
  try { rw [h a a a, <-h] }
  try { rw [h a a a a, <-h] }
  try { rw [h a a a a a, <-h] }
  try { rw [h a a a a a a, <-h] }
```

Note that the third it was necessary to use `try` instead of `repeat rw [<-h]` due to long loops.

Then generate one file per equation using:

```sh
ruby bruteforce.rb Apply
```

This generates a `Makefile.Apply` file and a `BruteforceApply` directory.

3) Run lean on generated files and collect errors

Move the `Makefile.Apply` to the root directory and `BruteforceApply` to `/equational_theories`. Then run the bruteforce:

```sh
make -f Makefile.Apply -j6
```

Note that you can insert the number of cores you'd like to parallelize across in the -j parameter above.

If this runs v ery rapidly, it's possible that your files are not being run correctly and that your output is corrupted. Check that the `BruteforceApply/Output` has files full of errors like:

```
equational_theories/BruteforceApply/bf_17.lean:4:2: error: tactic 'apply' failed, failed to unify
  ?x = ?y ∘ (?y ∘ ?y)
with
  x✝ = y✝
G : Type u_1
inst✝ : Magma G
h : Equation17 G
x✝ y✝ : G
⊢ x✝ = y✝
```

4) Find theorems that succeeded

Note that if your files failed to run and generate errors as mentioned above, this step will generate bad data.

Now to find what theorems succeeded, you can run:

```sh
ruby print_successful_theorems.rb BruteforceApply
```

You can run the following to print out successful pairs of implications in CSV format instead:
```sh
ruby print_successful_theorems.rb BruteforceApply | ruby -ne 'puts "#{$1},#{$2}" if $_ =~ /Equation(\d+)_implies_Equation(\d+)/'
```

5) Find the transitive reduction of implications

Given the CSV from above, you can calculate the transitive reduction (e.g. minimal set of implications necessary to print the entire set) using:

```sh
ruby scripts/transitive_reduction.rb Apply.csv
```

Using this output, it is now possible to re-generate the minimal set of theorems.
